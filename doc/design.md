# 詳細設計書（タグリスト解析スクリプト）

## 1. 概要

本ドキュメントは、SCP財団Wikiのタグリスト（日本語版・英語版）を解析し、タグ情報をJSONファイルとして出力するPythonスクリプトの詳細設計をまとめたものです。

- 日本語版: 複数ファイル（`tag-list.txt`・`fragment_*.txt`）を再帰的に結合し、タグ情報を抽出して`jp_tags.json`を生成
- 英語版: `05command_tech-hub-tag-list.txt`を解析し、タグ情報を抽出して`en_tags.json`を生成

## 2. 共通処理フロー

1. 入力ファイルの読み込み
2. タグ情報・メタ情報の抽出（正規表現利用）
3. データ構造化（Python辞書リスト）
4. JSONファイル出力

---

## 3. 日本語版タグリスト解析

### 3.1 入力ファイル

- `scp-jp/tag-list.txt`
- `scp-jp/fragment_*.txt`（`[[include :scp-jp:fragment:...]]`で再帰的に展開）

### 3.2 処理フロー

1. 起点ファイルを読み込み、`[[include ...]]`を検出したら該当フラグメントを再帰的に展開
2. 行ごとに走査し、
   - セクションヘッダ（`+ タイトル`/`++ タイトル`）でカテゴリ階層を管理
   - タグ定義（`* **[[[/system:page-tags/tag/スラッグ|タグ名]]]** //(英語名)// - 説明文`）を抽出
   - 直後のメタ情報行（`* // KEY: VALUE //`）を抽出
3. タグごとに以下の形式で辞書化

```python
{
    "name": "日本語タグ名",
    "slug": "タグスラッグ",
    "name_en": "英語タグ名" or None,
    "description": "説明文",
    "category": "カテゴリ名",
    "meta": { ... }
}
```

### 3.3 正規表現例

- セクション: `^\+\+?\s+(.*?)(?:\[\[#.*)?$`
- タグ定義: `^\*\s+\*\*\[{3}/system:page-tags/tag/([^|]+)\|([^\]]+)\]{3}\*\*\s+(?://\(([^)]+)\)//\s+)?-\s*(.*)`
- メタ情報: `^\*\s*//\s*([^:]+):\s*(.*?)\s*//`

### 3.4 考慮事項

- `[[include ...]]`の循環参照防止
- 英語タグ名の有無に対応
- CSSモジュール・タブビュー等は無視
- 文字エンコーディングエラー時は`safe_print`で回避

### 3.5 出力

- `jp_tags.json`（1576件実績）

---

## 4. 英語版タグリスト解析

### 4.1 入力ファイル

- `05command_tech-hub-tag-list.txt`

### 4.2 処理フロー

1. ファイルを行ごとに走査
2. タグ定義（`* **[URL TAG_NAME]**`）・説明文（`--`以降）を抽出
3. 直後のメタ情報（`* // KEY: VALUE //`）を抽出
4. タグごとに以下の形式で辞書化

```python
{
    "name": "タグ名",
    "description": "説明文",
    "meta": { ... }
}
```

### 4.3 正規表現例

- タグ定義: `^\s*\*\s*\*\*.*\*\*`
- メタ情報: `^\s*\*\s*//.*//`

### 4.4 考慮事項

- CSSモジュール・タブビュー・見出し行は無視
- Wikidotリンク記法はそのまま保持
- メタ情報は存在しない場合もある

### 4.5 出力

- `en_tags.json`

---

## 5. 参考・運用ルール

- 運用ルール・意思決定経緯・TODOは`doc/memories.md`参照
- 辞書ファイル名は`source_to_target.json`で統一
- 非使用タグは値を`null`とする
- 大きな設計変更時は`memories.md`を更新
