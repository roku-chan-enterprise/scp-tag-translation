<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>SCPタグ翻訳ツール</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      /* ベーススタイル */
      body {
        margin: 0;
        padding: 0;
        font-family: sans-serif;
        line-height: 1.4;
        background-color: #f8f8f8;
        color: #333;
      }

      header {
        padding: 1rem;
        background-color: #f0f0f0;
        border-bottom: 1px solid #ccc;
      }

      h1 {
        margin: 0;
        font-size: 1.25rem;
      }

      .container {
        width: 100%;
        max-width: 900px; /* ログ領域のはみ出しを防止 */
        margin: 0 auto;
        display: flex;
        flex-direction: row;
        gap: 1rem;
        padding: 1rem;
        box-sizing: border-box;
      }

      .column {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        min-width: 0; /* フレックス縮小時に要素がはみ出さないように */
      }

      label {
        font-weight: bold;
      }

      select {
        padding: 0.25rem;
        font-size: 0.9rem;
      }

      textarea {
        width: 100%;
        height: 8rem;
        box-sizing: border-box;
        resize: vertical;
        font-family: monospace;
        font-size: 0.95rem;
        padding: 0.5rem;
      }

      .buttons {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        margin: 0.5rem 0;
      }

      .button {
        padding: 0.4rem 0.8rem;
        font-size: 0.9rem;
        cursor: pointer;
        border: 1px solid #ccc;
        border-radius: 4px;
        background-color: #f0f0f0;
      }

      /* ログ表示欄 */
      #logArea {
        width: 100%;
        height: 6rem;
        border: 1px solid #ccc;
        padding: 0.5rem;
        white-space: pre-wrap;
        overflow-y: auto;
        background-color: #f7f7f7;
        color: #444;
        box-sizing: border-box;
      }

      /* ローディング表示（テキスト＋アニメーション） */
      #loadingIndicator {
        display: none; /* 初期は非表示 */
        font-size: 0.95rem;
        color: #333;
        margin-top: 0.5rem;
        display: flex;
        align-items: center;
      }

      .spinner {
        width: 20px;
        height: 20px;
        border: 3px solid #ccc;
        border-top: 3px solid #66a;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 8px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* ダークモード */
      @media (prefers-color-scheme: dark) {
        body {
          background-color: #222;
          color: #eee;
        }
        header,
        .container {
          background-color: #333;
        }
        select,
        textarea {
          background-color: #555;
          color: #eee;
          border: 1px solid #aaa;
        }
        .button {
          background-color: #444;
          color: #eee;
          border: 1px solid #aaa;
        }
        #logArea {
          background-color: #444;
          color: #ccc;
        }
        #loadingIndicator {
          color: #ccc;
        }
        .spinner {
          border: 3px solid #aaa;
          border-top: 3px solid #fff;
        }
      }

      /* 画面幅が狭い場合: 縦配置に切り替え */
      @media (max-width: 768px) {
        .container {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>SCPタグ翻訳ツール</h1>
    </header>

    <!-- メインの2カラム: 翻訳元 / 翻訳先 -->
    <div class="container">
      <div class="column">
        <label for="sourceLang">翻訳元言語</label>
        <select id="sourceLang">
          <!-- 今は英語(en)のみ対応 -->
          <option value="en" selected>English (en)</option>
          <!-- 将来的には以下を追加（コメントアウト中）
        <option value="cn">中文 (cn)</option>
        <option value="cs">Česky (cs)</option>
        <option value="de">Deutsch (de)</option>
        <option value="es">Español (es)</option>
        <option value="fr">Français (fr)</option>
        <option value="it">Italiano (it)</option>
        <option value="jp">日本語 (jp)</option>
        <option value="ko">한국어 (ko)</option>
        <option value="pl">Polski (pl)</option>
        <option value="pt">Português (pt)</option>
        <option value="ru">Русский (ru)</option>
        <option value="th">ภาษาไทย (th)</option>
        <option value="ua">Українська (ua)</option>
        <option value="vn">Tiếng Việt (vn)</option>
        <option value="zh">繁體中文 (zh)</option>
        --></select>

        <textarea id="sourceText" placeholder="翻訳したいタグを入力"></textarea>
      </div>

      <div class="column">
        <label for="targetLang">翻訳先言語</label>
        <select id="targetLang">
          <!-- 今は日本語(jp)のみ対応 -->
          <option value="jp" selected>日本語 (jp)</option>
          <!-- 将来的には以下を追加（コメントアウト中）
        <option value="en">English (en)</option>
        <option value="cn">中文 (cn)</option>
        <option value="cs">Česky (cs)</option>
        <option value="de">Deutsch (de)</option>
        <option value="es">Español (es)</option>
        <option value="fr">Français (fr)</option>
        <option value="it">Italiano (it)</option>
        <option value="ko">한국어 (ko)</option>
        <option value="pl">Polski (pl)</option>
        <option value="pt">Português (pt)</option>
        <option value="ru">Русский (ru)</option>
        <option value="th">ภาษาไทย (th)</option>
        <option value="ua">Українська (ua)</option>
        <option value="vn">Tiếng Việt (vn)</option>
        <option value="zh">繁體中文 (zh)</option>
        --></select>

        <textarea id="targetText" placeholder="翻訳結果"></textarea>
      </div>
    </div>

    <div class="buttons">
      <button class="button" id="translateButton">翻訳</button>
      <button class="button" id="clearButton">クリア</button>
    </div>

    <div id="logArea"></div>
    <div id="loadingIndicator">
      <div class="spinner"></div>
      読み込み中...
    </div>

    <script>
      // 辞書ファイルのベースパス（今後の保守性のため定数化）
      const DICTIONARY_BASE_PATH = './data/dictionaries/dictionaries/';

      // 各種キャッシュ
      const dictionaryCache = {};

      // ログエリアのクリア
      function clearLog() {
        document.getElementById("logArea").textContent = "";
      }

      // ログエリアへの出力
      function setLog(message) {
        const logArea = document.getElementById("logArea");
        logArea.textContent += `\n${message}`;
        logArea.scrollTop = logArea.scrollHeight; // スクロールを最下部へ
      }

      // ローディング表示の切替
      function showLoading(isLoading) {
        const loadingIndicator = document.getElementById("loadingIndicator");
        loadingIndicator.style.display = isLoading ? "flex" : "none";
      }

      // 辞書を用いた翻訳処理
      function doTranslationWithDictionary(dictionary, text, srcLang) {
        // 簡易的な単語単位の翻訳処理（実際にはもう少し複雑な処理が必要）
        const translatedText = text
          .split(/\s+/)
          .map((word) => dictionary[word] || word)
          .join(" ");
        document.getElementById("targetText").value = translatedText;
        setLog(`翻訳元: ${text}`);
        setLog(`翻訳先: ${translatedText}`);
      }

      // 翻訳処理の実行
      function doTranslate() {
        clearLog();
        showLoading(true);

        const srcLang = document.getElementById("sourceLang").value;
        const tgtLang = document.getElementById("targetLang").value;
        const mapKey = `${srcLang}_to_${tgtLang}`;
        const inputStr = document.getElementById("sourceText").value.trim();

        if (!inputStr) {
          // 入力が空のときは翻訳結果をクリアし、ローディング非表示
          document.getElementById("targetText").value = "";
          showLoading(false);
          return;
        }

        // すでに読み込み済みかどうか
        if (dictionaryCache[mapKey]) {
          doTranslationWithDictionary(
            dictionaryCache[mapKey],
            inputStr,
            srcLang
          );
          showLoading(false);
        } else {
          // 辞書ファイルをfetch
          const url = `${DICTIONARY_BASE_PATH}${mapKey}.json`;
          fetch(url)
            .then((res) => {
              if (!res.ok) {
                throw new Error(`辞書ファイルがありません (${mapKey}.json)`);
              }
              return res.json();
            })
            .then((data) => {
              dictionaryCache[mapKey] = data;
              doTranslationWithDictionary(data, inputStr, srcLang);
            })
            .catch((err) => {
              setLog(
                `【エラー】未対応ペア (${mapKey}) です。辞書ファイル読み込みに失敗。`
              );
              console.error(err);
              document.getElementById("targetText").value = "";
            })
            .finally(() => {
              showLoading(false);
            });
        }
      }

      // 各種イベントリスナー
      document
        .getElementById("translateButton")
        .addEventListener("click", doTranslate);
      document
        .getElementById("clearButton")
        .addEventListener("click", () => {
          document.getElementById("sourceText").value = "";
          document.getElementById("targetText").value = "";
          clearLog();
        });
    </script>
  </body>
</html>
